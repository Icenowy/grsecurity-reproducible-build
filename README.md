# Grsecurity Reproducible build scripts

These scripts are intended to do reproducible build for Linux kernel with Grsecurity patch set.

## Usage

```
./build-toolchain.sh # Build a intermediate toolchain
./gen-fingerprint.sh # Or copy other build fingerprint to fingerprint.sh
./build-kernel.sh # Build the kernel itself
```

Then the output kernel (bzImage, vmlinux, modules, and build fingerprint) is located at out/

## Config options to be noted

### CONFIG_MODULE_SIG (Module signature verification)

When this option is enabled, there will be a key embedded into the kernel, which is used to sign modules.

The key is either generated at build time (from /dev/random, which made the key not reproducible), or pre-generated (which made the signing system useless, as the key-pair will be provided to anyone who wants to verify the build).

Although support for pre-generated key-pair can be implemented, it's not implemented now.

So the option should be *DISABLED* now.

**TODO**: support for external pre-generated key-pair.

### CONFIG_PAX_LATENT_ENTROPY (Generate some entropy during boot and runtime)

When this option is enabled, the generated binary code will contain some random bits generated by GCC at build time, as entropy.

Enabling this option will lead to irreproducible builds.

So the option should be *DISABLED* now.

### CONFIG_GRKERNSEC_RANDSTRUCT (Randomize layout of sensitive kernel structures)

When this option is enabled, the generated binary will have sensitive kernel structures randomized.

It uses a seed from /dev/urandom at build time, however, currently the scripts have already hacked the seed generation process. Now the seed is part of the build fingerprint.

So the option is now *safe to ENABLE*.
